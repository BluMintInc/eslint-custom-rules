if [ "$CURSOR_BACKGROUND_AGENT" = "true" ]; then
  echo "Cursor Background Agent detected, skipping post-merge hooks"
  exit 0
fi

if git diff --name-only HEAD@{1} | grep -qE 'package(-lock)?\.json$'; then
  echo "Detected changes in package.json or package-lock.json. Running npm install..."
  npm install

  echo "Restarting ESLint server..."
  # Kill any running ESLint server processes
  if command -v pkill >/dev/null 2>&1; then
    pkill -f "eslint-server" || true
  elif command -v taskkill >/dev/null 2>&1; then
    taskkill /f /im eslint-server.exe 2>/dev/null || true
  fi

  # Most IDEs will automatically restart the ESLint server when needed
  # For Visual Studio Code, you can touch the ESLint configuration to trigger a restart
  touch .eslintrc.js 2>/dev/null || true
  echo "ESLint server should restart automatically in your IDE."
fi
